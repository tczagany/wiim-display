{"mappings":"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","sources":["<anon>","src/js/wiimd.js"],"sourcesContent":["var $4811da1c274ad200$exports = {};\n// =======================================================\n// WiiM Display\n// Namespacing\nwindow.WIIM = window.WIIM || {};\n// Default settings\nWIIM.s = {\n    // Host runs on default port 80, but in cases where another port is chosen adapt\n    locHostname: location.hostname,\n    locPort: location.port && location.port != \"80\" && location.port != \"1234\" ? location.port : \"80\",\n    rndAlbumArtUri: \"./img/fake-album-1.jpg\",\n    // Device selection\n    aDeviceUI: [\n        \"devName\",\n        \"mediaTitle\",\n        \"mediaSubTitle\",\n        \"mediaArtist\",\n        \"mediaAlbum\",\n        \"mediaBitRate\",\n        \"mediaBitDepth\",\n        \"mediaSampleRate\",\n        \"mediaQualityIdent\",\n        \"devVol\",\n        \"progressPlayed\",\n        \"progressLeft\",\n        \"progressPercent\",\n        \"mediaSource\",\n        \"albumArt\",\n        \"bgAlbumArtBlur\"\n    ]\n};\n// Data placeholders.\nWIIM.d = {\n    serverSettings: null,\n    deviceList: null,\n    prevTransportState: null,\n    prevPlayMedium: null,\n    prevSourceIdent: null,\n    prevTrackInfo: null\n};\n// Reference placeholders.\n// These are set in the init function\n// and are used to reference the UI elements in the app.\nWIIM.r = {};\n/**\n * Initialisation of app.\n * @returns {undefined}\n */ WIIM.Init = function() {\n    console.log(\"WIIM\", \"Initialising...\");\n    // Init Socket.IO, connect to port where server resides\n    console.log(\"WIIM DEBUG\", \"Listening on \" + this.s.locHostname + \":\" + this.s.locPort);\n    window.socket = io.connect(\":\" + this.s.locPort);\n    // Set references to the UI elements\n    this.setUIReferences();\n    // Set Socket.IO definitions\n    this.setSocketDefinitions();\n    // Initial calls, wait a bit for socket to start\n    setTimeout(()=>{\n        socket.emit(\"server-settings\");\n        socket.emit(\"devices-get\");\n    }, 500);\n};\n/**\n * Reference to the UI elements of the app.\n * @returns {undefined}\n */ WIIM.setUIReferences = function() {\n    console.log(\"WIIM\", \"Set UI references...\");\n    function addElementToRef(id) {\n        const element = document.getElementById(id);\n        if (element) WIIM.r[id] = element;\n        else console.warn(\"WIIM\", `Element with ID '${id}' not found.`);\n    }\n    // Set references to the UI elements\n    this.s.aDeviceUI.forEach((id)=>{\n        addElementToRef(id);\n    });\n};\n/**\n * Set the socket definitions to listen for specific websocket traffic and handle accordingly.\n * @returns {undefined}\n */ WIIM.setSocketDefinitions = function() {\n    console.log(\"WIIM\", \"Setting Socket definitions...\");\n    // On state\n    socket.on(\"state\", function(msg) {\n        if (!msg) return false;\n        // console.log(msg);\n        // Get player progress data from the state message.\n        var timeStampDiff = 0;\n        if (msg.CurrentTransportState === \"PLAYING\") timeStampDiff = msg.stateTimeStamp && msg.metadataTimeStamp ? Math.round((msg.stateTimeStamp - msg.metadataTimeStamp) / 1000) : 0;\n        var relTime = msg.RelTime ? msg.RelTime : \"00:00:00\";\n        var trackDuration = msg.TrackDuration ? msg.TrackDuration : \"00:00:00\";\n        // Get current player progress and set UI elements accordingly.\n        var playerProgress = WIIM.getPlayerProgress(relTime, trackDuration, timeStampDiff, msg.CurrentTransportState);\n        progressPlayed.children[0].innerText = playerProgress.played;\n        progressLeft.children[0].innerText = playerProgress.left != \"\" ? \"-\" + playerProgress.left : \"\";\n        progressPercent.setAttribute(\"aria-valuenow\", playerProgress.percent);\n        progressPercent.children[0].setAttribute(\"style\", \"width:\" + playerProgress.percent + \"%\");\n        // Device transport state or play medium changed...?\n        if (WIIM.d.prevTransportState !== msg.CurrentTransportState || WIIM.d.prevPlayMedium !== msg.PlayMedium) {\n            WIIM.d.prevTransportState = msg.CurrentTransportState; // Remember the last transport state\n            WIIM.d.prevPlayMedium = msg.PlayMedium; // Remember the last PlayMedium\n        }\n    });\n    // On metadata\n    socket.on(\"metadata\", function(msg) {\n        if (!msg) return false;\n        // Source detection\n        var playMedium = msg.PlayMedium ? msg.PlayMedium : \"\";\n        var trackSource = msg.TrackSource ? msg.TrackSource : \"\";\n        var sourceIdent = WIIM.getSourceIdent(playMedium, trackSource);\n        // Did the source ident change...?\n        if (sourceIdent !== WIIM.d.prevSourceIdent) {\n            if (sourceIdent !== \"\") {\n                var identImg = document.createElement(\"img\");\n                identImg.src = sourceIdent;\n                identImg.alt = playMedium + \": \" + trackSource;\n                identImg.title = playMedium + \": \" + trackSource;\n                mediaSource.innerHTML = identImg.outerHTML;\n            } else mediaSource.innerText = playMedium + \": \" + trackSource;\n            WIIM.d.prevSourceIdent = sourceIdent; // Remember the last Source Ident\n        }\n        // Song Title, Subtitle, Artist, Album\n        WIIM.r.mediaTitle.innerText = msg.Title ? msg.Title : \"\";\n        WIIM.r.mediaSubTitle.innerText = msg.Subtitle ? msg.Subtitle : \"\";\n        WIIM.r.mediaArtist.innerText = msg.Artist ? msg.Artist : \"\";\n        WIIM.r.mediaAlbum.innerText = msg.Album ? msg.Album : \"\";\n        if (playMedium === \"SONGLIST-NETWORK\" && !trackSource && msg.CurrentTransportState === \"STOPPED\") WIIM.r.mediaTitle.innerText = \"No Music Selected\";\n        var trackChanged = false;\n        var currentTrackInfo = WIIM.r.mediaTitle.innerText + \"|\" + WIIM.r.mediaSubTitle.innerText + \"|\" + WIIM.r.mediaArtist.innerText + \"|\" + WIIM.r.mediaAlbum.innerText;\n        if (WIIM.d.prevTrackInfo !== currentTrackInfo) {\n            trackChanged = true;\n            WIIM.d.prevTrackInfo = currentTrackInfo; // Remember the last track info\n            console.log(\"WIIM\", \"Track changed:\", currentTrackInfo);\n        }\n        // Audio quality\n        var songBitrate = msg.BitRate ? msg.BitRate : \"\";\n        var songBitDepth = msg.BitDepth ? msg.BitDepth : \"\";\n        var songSampleRate = msg.SampleRate ? msg.SampleRate : \"\";\n        WIIM.r.mediaBitRate.innerText = songBitrate > 0 ? songBitrate > 1000 ? (songBitrate / 1000).toFixed(2) + \" mbps, \" : songBitrate + \" kbps, \" : \"\";\n        WIIM.r.mediaBitDepth.innerText = songBitDepth > 0 ? songBitDepth > 24 ? \"24 bit/\" : songBitDepth + \" bit/\" : \"\";\n        WIIM.r.mediaSampleRate.innerText = songSampleRate > 0 ? (songSampleRate / 1000).toFixed(1) + \" kHz\" : \"\";\n        if (!songBitrate && !songBitDepth && !songSampleRate) WIIM.r.mediaQualityIdent.style.display = \"none\";\n        else WIIM.r.mediaQualityIdent.style.display = \"inline-block\";\n        // Audio quality ident badge (HD/Hi-res/CD/...)\n        var songQuality = msg.Quality ? msg.Quality : \"\";\n        var songActualQuality = msg.ActualQuality ? msg.ActualQuality : \"\";\n        var qualiIdent = WIIM.getQualityIdent(songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate);\n        if (qualiIdent !== \"\") {\n            WIIM.r.mediaQualityIdent.innerText = qualiIdent;\n            WIIM.r.mediaQualityIdent.title = \"Quality: \" + songQuality + \", \" + songActualQuality;\n        } else {\n            var identId = document.createElement(\"i\");\n            identId.className = \"bi bi-soundwave text-secondary\";\n            identId.title = \"Quality: \" + songQuality + \", \" + songActualQuality;\n            WIIM.r.mediaQualityIdent.innerHTML = identId.outerHTML;\n        }\n        // Pre-process Album Art uri, if any is available from the metadata.\n        var albumArtUri = WIIM.checkAlbumArtURI(msg.AlbumCoverURI ? msg.AlbumCoverURI : \"\", msg.TimeStamp);\n        // Set Album Art, only if the track changed and the URI changed\n        if (trackChanged && WIIM.r.albumArt.src != albumArtUri) WIIM.setAlbumArt(albumArtUri);\n        // Device volume\n        WIIM.r.devVol.innerText = msg.CurrentVolume ? msg.CurrentVolume : \"-\";\n    });\n    // On device set\n    socket.on(\"device-set\", function(msg) {\n        // Device switch? Fetch settings and device info again.\n        socket.emit(\"server-settings\");\n        socket.emit(\"devices-get\");\n    });\n};\n// =======================================================\n// Helper functions\n/**\n * Get player progress helper.\n * @param {string} relTime - Time elapsed while playing, format 00:00:00\n * @param {string} trackDuration - Total play time, format 00:00:00\n * @param {integer} timeStampDiff - Possible play time offset in seconds\n * @param {string} currentTransportState - The current transport state \"PLAYING\" or otherwise\n * @returns {object} An object with corrected played, left, total and percentage played\n */ WIIM.getPlayerProgress = function(relTime, trackDuration, timeStampDiff, currentTransportState) {\n    var relTimeSec = this.convertToSeconds(relTime) + timeStampDiff;\n    var trackDurationSec = this.convertToSeconds(trackDuration);\n    if (trackDurationSec > 0 && relTimeSec < trackDurationSec) {\n        // var percentPlayed = Math.floor((relTimeSec / trackDurationSec) * 100);\n        var percentPlayed = (relTimeSec / trackDurationSec * 100).toFixed(1);\n        return {\n            played: WIIM.convertToMinutes(relTimeSec),\n            left: WIIM.convertToMinutes(trackDurationSec - relTimeSec),\n            total: WIIM.convertToMinutes(trackDurationSec),\n            percent: percentPlayed\n        };\n    } else if (trackDurationSec == 0 && currentTransportState == \"PLAYING\") return {\n        played: \"Live\",\n        left: \"\",\n        total: \"\",\n        percent: 100\n    };\n    else return {\n        played: \"Paused\",\n        left: \"\",\n        total: \"\",\n        percent: 0\n    };\n};\n/**\n * Convert time format '00:00:00' to total number of seconds.\n * @param {string} sDuration - Time, format 00:00:00.\n * @returns {integer} The number of seconds that the string represents.\n */ WIIM.convertToSeconds = function(sDuration) {\n    const timeSections = sDuration.split(\":\");\n    let totalSeconds = 0;\n    for(let i = 0; i < timeSections.length; i++){\n        var nFactor = timeSections.length - 1 - i; // Count backwards\n        var nMultiplier = Math.pow(60, nFactor); // 60^n\n        totalSeconds += nMultiplier * parseInt(timeSections[i]); // Calculate the seconds\n    }\n    return totalSeconds;\n};\n/**\n * Convert number of seconds to '00:00' string format. \n * Sorry for those hour+ long songs...\n * @param {integer} seconds - Number of seconds total.\n * @returns {string} The string representation of seconds in minutes, format 00:00.\n */ WIIM.convertToMinutes = function(seconds) {\n    var tempDate = new Date(0);\n    tempDate.setSeconds(seconds);\n    var result = tempDate.toISOString().substring(14, 19);\n    return result;\n};\n/**\n * Check if the album art is a valid URI. Returns the URI if valid, otherwise a random URI.\n * Error handling is handled by the onerror event on the image itself.\n * @param {string} sAlbumArtUri - The URI of the album art.\n * @param {integer} nTimestamp - The time in milliseconds, used as cache buster.\n * @returns {string} The URI of the album art.\n */ WIIM.checkAlbumArtURI = function(sAlbumArtUri, nTimestamp) {\n    // If the URI starts with https, the self signed certificate may not trusted by the browser.\n    // Hence we always try and load the image through a reverse proxy, ignoring the certificate.\n    if (sAlbumArtUri && sAlbumArtUri.startsWith(\"https\")) {\n        if (WIIM.s.locPort != \"80\") return \"http://\" + WIIM.s.locHostname + \":\" + WIIM.s.locPort + \"/proxy?url=\" + encodeURIComponent(sAlbumArtUri) + \"&ts=\" + nTimestamp; // Use the current timestamp as cache buster\n        else return \"http://\" + WIIM.s.locHostname + \"/proxy?url=\" + encodeURIComponent(sAlbumArtUri) + \"&ts=\" + nTimestamp; // Use the current timestamp as cache buster\n    } else if (sAlbumArtUri && sAlbumArtUri.startsWith(\"http\")) return sAlbumArtUri;\n    else // If not, use the random album art URI\n    return WIIM.s.rndAlbumArtUri;\n};\n/**\n * Sets the album art. Both on the foreground and background.\n * @param {integer} imgUri - The URI of the album art.\n * @returns {undefined}\n */ WIIM.setAlbumArt = function(imgUri) {\n    console.log(\"WIIM\", \"Set Album Art\", imgUri);\n    this.r.albumArt.src = imgUri;\n    this.r.bgAlbumArtBlur.style.backgroundImage = \"url('\" + imgUri + \"')\";\n};\n/**\n * Get a random number between min and max, including min and max.\n * @param {integer} min - Minimum number to pick, keep it lower than max.\n * @param {integer} max - Maximum number to pick.\n * @returns {integer} The random number\n */ WIIM.rndNumber = function(min, max) {\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n};\n/**\n * Get an identifier for the current play medium combined with the tracksource.\n * TODO: Verify all/most sources...\n * @param {string} playMedium - The PlayMedium as indicated by the device. Values: SONGLIST-NETWORK, RADIO-NETWORK, STATION-NETWORK, CAST, AIRPLAY, SPOTIFY, UNKOWN\n * @param {string} trackSource - The stream source as indicated by the device. Values: Prime, Qobuz, SPOTIFY, newTuneIn, iHeartRadio, Deezer, UPnPServer, Tidal, vTuner\n * @returns {string} The uri to the source identifier (image url)\n */ WIIM.getSourceIdent = function(playMedium, trackSource) {\n    var sIdentUri = \"\";\n    switch(playMedium.toLowerCase()){\n        case \"airplay\":\n            sIdentUri = \"./img/sources/airplay2.png\";\n            break;\n        case \"third-dlna\":\n            sIdentUri = \"./img/sources/dlna2.png\";\n            break;\n        case \"cast\":\n            sIdentUri = \"./img/sources/chromecast2.png\";\n            break;\n        case \"radio-network\":\n            sIdentUri = \"./img/sources/radio.png\";\n            break;\n        case \"songlist-network\":\n            sIdentUri = \"./img/sources/ethernet2.png\";\n            break;\n        case \"spotify\":\n            sIdentUri = \"./img/sources/spotify.png\";\n            break;\n        case \"squeezelite\":\n            sIdentUri = \"./img/sources/music-assistant2.png\";\n            break;\n        case \"none\":\n            sIdentUri = \"./img/sources/none2.png\";\n            break;\n        case \"bluetooth\":\n            sIdentUri = \"./img/sources/bluetooth2.png\";\n            break;\n        case \"hdmi\":\n            sIdentUri = \"./img/sources/hdmi2.png\";\n            break;\n        case \"line-in\":\n            sIdentUri = \"./img/sources/line-in2.png\";\n            break;\n        case \"optical\":\n            sIdentUri = \"./img/sources/spdif2.png\";\n            break;\n    }\n    switch(trackSource.toLowerCase()){\n        case \"deezer\":\n        case \"deezer2\":\n            sIdentUri = \"./img/sources/deezer.png\";\n            break;\n        case \"iheartradio\":\n            sIdentUri = \"./img/sources/iheart.png\";\n            break;\n        case \"newtunein\":\n            sIdentUri = \"./img/sources/newtunein.png\";\n            break;\n        case \"plex\":\n            sIdentUri = \"./img/sources/plex.png\";\n            break;\n        case \"prime\":\n            sIdentUri = \"./img/sources/amazon-music2.png\";\n            break;\n        case \"qobuz\":\n            sIdentUri = \"./img/sources/qobuz2.png\";\n            break;\n        case \"tidal\":\n            sIdentUri = \"./img/sources/tidal2.png\";\n            break;\n        case \"upnpserver\":\n            sIdentUri = \"./img/sources/dlna2.png\";\n            break;\n        case \"vtuner\":\n            sIdentUri = \"./img/sources/vtuner2.png\";\n            break;\n    }\n    return sIdentUri;\n};\n/**\n * Get an identifier for the current audio/song quality.\n * TODO: Verify all/most sources...\n * Found so far:\n * \n * CD Quality: 44.1 KHz/16 bit. Bitrate 1,411 kbps. For mp3 bitrate can vary, but also be 320/192/160/128/... kbps.\n * Hi-Res quality: 96 kHz/24 bit and up. Bitrate 9,216 kbps.\n * \n * Spotify and Pandora usual bitrate 160 kbps, premium is 320 kbps\n * Tidal has CD quality, and FLAC, MQA, Master, ...\n * Qobuz apparently really has hi-res?\n * Amazon Music (Unlimited) does Atmos?\n * Apple Music -> Airplay 2, does hi-res?\n * YouTube Music -> Cast, does what?\n * \n * TIDAL -\n * Sample High: \"song:quality\":\"2\",\"song:actualQuality\":\"LOSSLESS\"\n * Sample MQA: \"song:quality\":\"3\",\"song:actualQuality\":\"HI_RES\"\n * Sample FLAC: \"song:quality\":\"4\",\"song:actualQuality\":\"HI_RES_LOSSLESS\"\n * \n * @param {integer} songQuality - A number identifying the quality, as indicated by the streaming service(?).\n * @param {string} songActualQuality - An indicator for the actual quality, as indicated by the streaming service(?).\n * @param {integer} songBitrate - The current bitrate in kilobit per second.\n * @param {integer} songBitDepth - The current sample depth in bits.\n * @param {integer} songSampleRate - The current sample rate in Hz.\n * @returns {string} The identifier for the audio quality, just a string.\n */ WIIM.getQualityIdent = function(songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate) {\n    // console.log(songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate);\n    var sIdent = \"\";\n    if (songBitrate > 1000 && songBitDepth === 16 && songSampleRate === 44100) sIdent = \"CD\";\n    else if (songBitrate > 7000 && songBitDepth >= 24 && songSampleRate >= 96000) sIdent = \"Hi-Res\";\n    // Based of Tidal/Amazon Music Unlimited/Deezer/Qobuz\n    switch(songQuality + \":\" + songActualQuality){\n        case \"2:LOSSLESS\":\n        case \":LOSSLESS\":\n            sIdent = \"HIGH\";\n            break;\n        case \"3:HI_RES\":\n            sIdent = \"MQA\";\n            break;\n        case \"4:HI_RES_LOSSLESS\":\n        case \":HI_RES_LOSSLESS\":\n        case \"0:LOSSLESS\":\n            sIdent = \"FLAC\";\n            break;\n        case \":UHD\":\n            sIdent = \"ULTRA HD\";\n            break;\n        case \":HD\":\n            sIdent = \"HD\"; // Amazon Music\n            break;\n        case \"3:7\":\n        case \"4:27\":\n            sIdent = \"Hi-Res\"; // Qobuz\n            break;\n        case \"2:6\":\n            sIdent = \"CD\"; // Qobuz\n            break;\n    }\n    return sIdent;\n};\n// =======================================================\n// Start WiiM Display app\nWIIM.Init();\n\n\n//# sourceMappingURL=wiimd.22ac49f2.js.map\n","// =======================================================\n// WiiM Display\n\n// Namespacing\nwindow.WIIM = window.WIIM || {};\n\n// Default settings\nWIIM.s = {\n    // Host runs on default port 80, but in cases where another port is chosen adapt\n    locHostname: location.hostname,\n    locPort: (location.port && location.port != \"80\" && location.port != \"1234\") ? location.port : \"80\",\n    rndAlbumArtUri: \"./img/fake-album-1.jpg\",\n    // Device selection\n    aDeviceUI: [\"devName\", \"mediaTitle\", \"mediaSubTitle\", \"mediaArtist\", \"mediaAlbum\", \"mediaBitRate\", \"mediaBitDepth\", \"mediaSampleRate\", \"mediaQualityIdent\", \"devVol\", \"progressPlayed\", \"progressLeft\", \"progressPercent\", \"mediaSource\", \"albumArt\", \"bgAlbumArtBlur\"],\n};\n\n// Data placeholders.\nWIIM.d = {\n    serverSettings: null, // Server settings, used to store the server settings\n    deviceList: null, // Device list, used to store the devices found through SSDP\n    prevTransportState: null, // Previous transport state, used to detect changes in the transport state\n    prevPlayMedium: null, // Previous play medium, used to detect changes in the play medium\n    prevSourceIdent: null, // Previous source ident, used to detect changes in the source\n    prevTrackInfo: null, // Previous track info, used to detect changes in the metadata\n};\n\n// Reference placeholders.\n// These are set in the init function\n// and are used to reference the UI elements in the app.\nWIIM.r = {};\n\n/**\n * Initialisation of app.\n * @returns {undefined}\n */\nWIIM.Init = function () {\n    console.log(\"WIIM\", \"Initialising...\");\n\n    // Init Socket.IO, connect to port where server resides\n    console.log(\"WIIM DEBUG\", \"Listening on \" + this.s.locHostname + \":\" + this.s.locPort)\n    window.socket = io.connect(\":\" + this.s.locPort);\n\n    // Set references to the UI elements\n    this.setUIReferences();\n\n    // Set Socket.IO definitions\n    this.setSocketDefinitions();\n\n    // Initial calls, wait a bit for socket to start\n    setTimeout(() => {\n        socket.emit(\"server-settings\");\n        socket.emit(\"devices-get\");\n    }, 500);\n};\n\n/**\n * Reference to the UI elements of the app.\n * @returns {undefined}\n */\nWIIM.setUIReferences = function () {\n    console.log(\"WIIM\", \"Set UI references...\");\n\n    function addElementToRef(id) {\n        const element = document.getElementById(id);\n        if (element) {\n            WIIM.r[id] = element;\n        } else {\n            console.warn(\"WIIM\", `Element with ID '${id}' not found.`);\n        }\n    }\n\n    // Set references to the UI elements\n    this.s.aDeviceUI.forEach((id) => { addElementToRef(id); });\n};\n\n/**\n * Set the socket definitions to listen for specific websocket traffic and handle accordingly.\n * @returns {undefined}\n */\nWIIM.setSocketDefinitions = function () {\n    console.log(\"WIIM\", \"Setting Socket definitions...\")\n\n    // On state\n    socket.on(\"state\", function (msg) {\n        if (!msg) { return false; }\n        // console.log(msg);\n\n        // Get player progress data from the state message.\n        var timeStampDiff = 0;\n        if (msg.CurrentTransportState === \"PLAYING\") {\n            timeStampDiff = (msg.stateTimeStamp && msg.metadataTimeStamp) ? Math.round((msg.stateTimeStamp - msg.metadataTimeStamp) / 1000) : 0;\n        }\n        var relTime = (msg.RelTime) ? msg.RelTime : \"00:00:00\";\n        var trackDuration = (msg.TrackDuration) ? msg.TrackDuration : \"00:00:00\";\n\n        // Get current player progress and set UI elements accordingly.\n        var playerProgress = WIIM.getPlayerProgress(relTime, trackDuration, timeStampDiff, msg.CurrentTransportState);\n        progressPlayed.children[0].innerText = playerProgress.played;\n        progressLeft.children[0].innerText = (playerProgress.left != \"\") ? \"-\" + playerProgress.left : \"\";\n        progressPercent.setAttribute(\"aria-valuenow\", playerProgress.percent)\n        progressPercent.children[0].setAttribute(\"style\", \"width:\" + playerProgress.percent + \"%\");\n\n        // Device transport state or play medium changed...?\n        if (WIIM.d.prevTransportState !== msg.CurrentTransportState || WIIM.d.prevPlayMedium !== msg.PlayMedium) {\n            WIIM.d.prevTransportState = msg.CurrentTransportState; // Remember the last transport state\n            WIIM.d.prevPlayMedium = msg.PlayMedium; // Remember the last PlayMedium\n        }\n    });\n\n    // On metadata\n    socket.on(\"metadata\", function (msg) {\n        if (!msg) { return false; }\n\n        // Source detection\n        var playMedium = (msg.PlayMedium) ? msg.PlayMedium : \"\";\n        var trackSource = (msg.TrackSource) ? msg.TrackSource : \"\";\n        var sourceIdent = WIIM.getSourceIdent(playMedium, trackSource);\n        // Did the source ident change...?\n        if (sourceIdent !== WIIM.d.prevSourceIdent) {\n            if (sourceIdent !== \"\") {\n                var identImg = document.createElement(\"img\");\n                identImg.src = sourceIdent;\n                identImg.alt = playMedium + \": \" + trackSource;\n                identImg.title = playMedium + \": \" + trackSource;\n                mediaSource.innerHTML = identImg.outerHTML;\n            }\n            else {\n                mediaSource.innerText = playMedium + \": \" + trackSource;\n            }\n            WIIM.d.prevSourceIdent = sourceIdent; // Remember the last Source Ident\n        }\n\n        // Song Title, Subtitle, Artist, Album\n        WIIM.r.mediaTitle.innerText = msg.Title ? msg.Title : \"\";\n        WIIM.r.mediaSubTitle.innerText = msg.Subtitle ? msg.Subtitle : \"\";\n        WIIM.r.mediaArtist.innerText = msg.Artist ? msg.Artist : \"\";\n        WIIM.r.mediaAlbum.innerText = msg.Album ? msg.Album : \"\";\n        if (playMedium === \"SONGLIST-NETWORK\" && !trackSource && msg.CurrentTransportState === \"STOPPED\") {\n            WIIM.r.mediaTitle.innerText = \"No Music Selected\";\n        }\n        var trackChanged = false;\n        var currentTrackInfo = WIIM.r.mediaTitle.innerText + \"|\" + WIIM.r.mediaSubTitle.innerText + \"|\" + WIIM.r.mediaArtist.innerText + \"|\" + WIIM.r.mediaAlbum.innerText;\n        if (WIIM.d.prevTrackInfo !== currentTrackInfo) {\n            trackChanged = true;\n            WIIM.d.prevTrackInfo = currentTrackInfo; // Remember the last track info\n            console.log(\"WIIM\", \"Track changed:\", currentTrackInfo);\n        }\n\n        // Audio quality\n        var songBitrate = msg.BitRate ? msg.BitRate : \"\";\n        var songBitDepth = msg.BitDepth ? msg.BitDepth : \"\";\n        var songSampleRate = msg.SampleRate ? msg.SampleRate : \"\";\n        WIIM.r.mediaBitRate.innerText = (songBitrate > 0) ? ((songBitrate > 1000) ? (songBitrate / 1000).toFixed(2) + \" mbps, \" : songBitrate + \" kbps, \") : \"\";\n        WIIM.r.mediaBitDepth.innerText = (songBitDepth > 0) ? ((songBitDepth > 24) ? \"24 bit/\" : songBitDepth + \" bit/\") : \"\";\n        WIIM.r.mediaSampleRate.innerText = (songSampleRate > 0) ? (songSampleRate / 1000).toFixed(1) + \" kHz\" : \"\";\n        if (!songBitrate && !songBitDepth && !songSampleRate) {\n            WIIM.r.mediaQualityIdent.style.display = \"none\";\n        }\n        else {\n            WIIM.r.mediaQualityIdent.style.display = \"inline-block\";\n        }\n\n        // Audio quality ident badge (HD/Hi-res/CD/...)\n        var songQuality = msg.Quality ? msg.Quality : \"\";\n        var songActualQuality = msg.ActualQuality ? msg.ActualQuality : \"\";\n        var qualiIdent = WIIM.getQualityIdent(songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate);\n        if (qualiIdent !== \"\") {\n            WIIM.r.mediaQualityIdent.innerText = qualiIdent;\n            WIIM.r.mediaQualityIdent.title = \"Quality: \" + songQuality + \", \" + songActualQuality;\n        }\n        else {\n            var identId = document.createElement(\"i\");\n            identId.className = \"bi bi-soundwave text-secondary\";\n            identId.title = \"Quality: \" + songQuality + \", \" + songActualQuality;\n            WIIM.r.mediaQualityIdent.innerHTML = identId.outerHTML;\n        }\n\n        // Pre-process Album Art uri, if any is available from the metadata.\n        var albumArtUri = WIIM.checkAlbumArtURI(msg.AlbumCoverURI ? msg.AlbumCoverURI : \"\", msg.TimeStamp);\n\n        // Set Album Art, only if the track changed and the URI changed\n        if (trackChanged && WIIM.r.albumArt.src != albumArtUri) {\n            WIIM.setAlbumArt(albumArtUri);\n        }\n\n        // Device volume\n        WIIM.r.devVol.innerText = msg.CurrentVolume ? msg.CurrentVolume : \"-\";\n    });\n\n    // On device set\n    socket.on(\"device-set\", function (msg) {\n        // Device switch? Fetch settings and device info again.\n        socket.emit(\"server-settings\");\n        socket.emit(\"devices-get\");\n    });\n};\n\n// =======================================================\n// Helper functions\n\n/**\n * Get player progress helper.\n * @param {string} relTime - Time elapsed while playing, format 00:00:00\n * @param {string} trackDuration - Total play time, format 00:00:00\n * @param {integer} timeStampDiff - Possible play time offset in seconds\n * @param {string} currentTransportState - The current transport state \"PLAYING\" or otherwise\n * @returns {object} An object with corrected played, left, total and percentage played\n */\nWIIM.getPlayerProgress = function (relTime, trackDuration, timeStampDiff, currentTransportState) {\n    var relTimeSec = this.convertToSeconds(relTime) + timeStampDiff;\n    var trackDurationSec = this.convertToSeconds(trackDuration);\n    if (trackDurationSec > 0 && relTimeSec < trackDurationSec) {\n        // var percentPlayed = Math.floor((relTimeSec / trackDurationSec) * 100);\n        var percentPlayed = ((relTimeSec / trackDurationSec) * 100).toFixed(1);\n        return {\n            played: WIIM.convertToMinutes(relTimeSec),\n            left: WIIM.convertToMinutes(trackDurationSec - relTimeSec),\n            total: WIIM.convertToMinutes(trackDurationSec),\n            percent: percentPlayed\n        };\n    }\n    else if (trackDurationSec == 0 && currentTransportState == \"PLAYING\") {\n        return {\n            played: \"Live\",\n            left: \"\",\n            total: \"\",\n            percent: 100\n        };\n    }\n    else {\n        return {\n            played: \"Paused\",\n            left: \"\",\n            total: \"\",\n            percent: 0\n        };\n    };\n};\n\n/**\n * Convert time format '00:00:00' to total number of seconds.\n * @param {string} sDuration - Time, format 00:00:00.\n * @returns {integer} The number of seconds that the string represents.\n */\nWIIM.convertToSeconds = function (sDuration) {\n    const timeSections = sDuration.split(\":\");\n    let totalSeconds = 0;\n    for (let i = 0; i < timeSections.length; i++) {\n        var nFactor = timeSections.length - 1 - i; // Count backwards\n        var nMultiplier = Math.pow(60, nFactor); // 60^n\n        totalSeconds += nMultiplier * parseInt(timeSections[i]); // Calculate the seconds\n    }\n    return totalSeconds\n};\n\n/**\n * Convert number of seconds to '00:00' string format. \n * Sorry for those hour+ long songs...\n * @param {integer} seconds - Number of seconds total.\n * @returns {string} The string representation of seconds in minutes, format 00:00.\n */\nWIIM.convertToMinutes = function (seconds) {\n    var tempDate = new Date(0);\n    tempDate.setSeconds(seconds);\n    var result = tempDate.toISOString().substring(14, 19);\n    return result;\n};\n\n/**\n * Check if the album art is a valid URI. Returns the URI if valid, otherwise a random URI.\n * Error handling is handled by the onerror event on the image itself.\n * @param {string} sAlbumArtUri - The URI of the album art.\n * @param {integer} nTimestamp - The time in milliseconds, used as cache buster.\n * @returns {string} The URI of the album art.\n */\nWIIM.checkAlbumArtURI = function (sAlbumArtUri, nTimestamp) {\n    // If the URI starts with https, the self signed certificate may not trusted by the browser.\n    // Hence we always try and load the image through a reverse proxy, ignoring the certificate.\n    if (sAlbumArtUri && sAlbumArtUri.startsWith(\"https\")) {\n        if (WIIM.s.locPort != \"80\") { // If the server is not running on port 80, we need to add the port to the URI\n            return \"http://\" + WIIM.s.locHostname + \":\" + WIIM.s.locPort + \"/proxy?url=\" + encodeURIComponent(sAlbumArtUri) + \"&ts=\" + nTimestamp; // Use the current timestamp as cache buster\n        } else {\n            return \"http://\" + WIIM.s.locHostname + \"/proxy?url=\" + encodeURIComponent(sAlbumArtUri) + \"&ts=\" + nTimestamp; // Use the current timestamp as cache buster\n        }\n    } else if (sAlbumArtUri && sAlbumArtUri.startsWith(\"http\")) {\n        return sAlbumArtUri;\n    } else {\n        // If not, use the random album art URI\n        return WIIM.s.rndAlbumArtUri;\n    }\n};\n\n/**\n * Sets the album art. Both on the foreground and background.\n * @param {integer} imgUri - The URI of the album art.\n * @returns {undefined}\n */\nWIIM.setAlbumArt = function (imgUri) {\n    console.log(\"WIIM\", \"Set Album Art\", imgUri);\n    this.r.albumArt.src = imgUri;\n    this.r.bgAlbumArtBlur.style.backgroundImage = \"url('\" + imgUri + \"')\";\n};\n\n/**\n * Get a random number between min and max, including min and max.\n * @param {integer} min - Minimum number to pick, keep it lower than max.\n * @param {integer} max - Maximum number to pick.\n * @returns {integer} The random number\n */\nWIIM.rndNumber = function (min, max) {\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n};\n\n/**\n * Get an identifier for the current play medium combined with the tracksource.\n * TODO: Verify all/most sources...\n * @param {string} playMedium - The PlayMedium as indicated by the device. Values: SONGLIST-NETWORK, RADIO-NETWORK, STATION-NETWORK, CAST, AIRPLAY, SPOTIFY, UNKOWN\n * @param {string} trackSource - The stream source as indicated by the device. Values: Prime, Qobuz, SPOTIFY, newTuneIn, iHeartRadio, Deezer, UPnPServer, Tidal, vTuner\n * @returns {string} The uri to the source identifier (image url)\n */\nWIIM.getSourceIdent = function (playMedium, trackSource) {\n\n    var sIdentUri = \"\";\n\n    switch (playMedium.toLowerCase()) {\n        case \"airplay\":\n            sIdentUri = \"./img/sources/airplay2.png\";\n            break;\n        case \"third-dlna\":\n            sIdentUri = \"./img/sources/dlna2.png\";\n            break;\n        case \"cast\":\n            sIdentUri = \"./img/sources/chromecast2.png\";\n            break;\n        case \"radio-network\":\n            sIdentUri = \"./img/sources/radio.png\";\n            break;\n        case \"songlist-network\":\n            sIdentUri = \"./img/sources/ethernet2.png\";\n            break;\n        case \"spotify\":\n            sIdentUri = \"./img/sources/spotify.png\";\n            break;\n        case \"squeezelite\":\n            sIdentUri = \"./img/sources/music-assistant2.png\";\n            break;\n        case \"none\":\n            sIdentUri = \"./img/sources/none2.png\";\n            break;\n        case \"bluetooth\":\n            sIdentUri = \"./img/sources/bluetooth2.png\";\n            break;\n        case \"hdmi\":\n            sIdentUri = \"./img/sources/hdmi2.png\";\n            break;\n        case \"line-in\":\n            sIdentUri = \"./img/sources/line-in2.png\";\n            break;\n        case \"optical\":\n            sIdentUri = \"./img/sources/spdif2.png\";\n            break;\n    };\n\n    switch (trackSource.toLowerCase()) {\n        case \"deezer\":\n        case \"deezer2\":\n            sIdentUri = \"./img/sources/deezer.png\";\n            break;\n        case \"iheartradio\":\n            sIdentUri = \"./img/sources/iheart.png\";\n            break;\n        case \"newtunein\":\n            sIdentUri = \"./img/sources/newtunein.png\";\n            break;\n        case \"plex\":\n            sIdentUri = \"./img/sources/plex.png\";\n            break;\n        case \"prime\":\n            sIdentUri = \"./img/sources/amazon-music2.png\";\n            break;\n        case \"qobuz\":\n            sIdentUri = \"./img/sources/qobuz2.png\";\n            break;\n        case \"tidal\":\n            sIdentUri = \"./img/sources/tidal2.png\";\n            break;\n        case \"upnpserver\":\n            sIdentUri = \"./img/sources/dlna2.png\";\n            break;\n        case \"vtuner\":\n            sIdentUri = \"./img/sources/vtuner2.png\";\n            break;\n    };\n\n    return sIdentUri;\n\n};\n\n/**\n * Get an identifier for the current audio/song quality.\n * TODO: Verify all/most sources...\n * Found so far:\n * \n * CD Quality: 44.1 KHz/16 bit. Bitrate 1,411 kbps. For mp3 bitrate can vary, but also be 320/192/160/128/... kbps.\n * Hi-Res quality: 96 kHz/24 bit and up. Bitrate 9,216 kbps.\n * \n * Spotify and Pandora usual bitrate 160 kbps, premium is 320 kbps\n * Tidal has CD quality, and FLAC, MQA, Master, ...\n * Qobuz apparently really has hi-res?\n * Amazon Music (Unlimited) does Atmos?\n * Apple Music -> Airplay 2, does hi-res?\n * YouTube Music -> Cast, does what?\n * \n * TIDAL -\n * Sample High: \"song:quality\":\"2\",\"song:actualQuality\":\"LOSSLESS\"\n * Sample MQA: \"song:quality\":\"3\",\"song:actualQuality\":\"HI_RES\"\n * Sample FLAC: \"song:quality\":\"4\",\"song:actualQuality\":\"HI_RES_LOSSLESS\"\n * \n * @param {integer} songQuality - A number identifying the quality, as indicated by the streaming service(?).\n * @param {string} songActualQuality - An indicator for the actual quality, as indicated by the streaming service(?).\n * @param {integer} songBitrate - The current bitrate in kilobit per second.\n * @param {integer} songBitDepth - The current sample depth in bits.\n * @param {integer} songSampleRate - The current sample rate in Hz.\n * @returns {string} The identifier for the audio quality, just a string.\n */\nWIIM.getQualityIdent = function (songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate) {\n    // console.log(songQuality, songActualQuality, songBitrate, songBitDepth, songSampleRate);\n\n    var sIdent = \"\";\n\n    if (songBitrate > 1000 && songBitDepth === 16 && songSampleRate === 44100) {\n        sIdent = \"CD\";\n    }\n    else if (songBitrate > 7000 && songBitDepth >= 24 && songSampleRate >= 96000) {\n        sIdent = \"Hi-Res\";\n    }\n\n    // Based of Tidal/Amazon Music Unlimited/Deezer/Qobuz\n    switch (songQuality + \":\" + songActualQuality) {\n        case \"2:LOSSLESS\": // Tidal\n        case \":LOSSLESS\": // Tidal\n            sIdent = \"HIGH\";\n            break;\n        case \"3:HI_RES\": // Tidal\n            sIdent = \"MQA\";\n            break;\n        case \"4:HI_RES_LOSSLESS\": // Tidal\n        case \":HI_RES_LOSSLESS\": // Tidal\n        case \"0:LOSSLESS\": // Deezer\n            sIdent = \"FLAC\";\n            break;\n        case \":UHD\": // Amazon Music\n            sIdent = \"ULTRA HD\";\n            break;\n        case \":HD\":\n            sIdent = \"HD\"; // Amazon Music\n            break;\n        case \"3:7\":\n        case \"4:27\":\n            sIdent = \"Hi-Res\"; // Qobuz\n            break;\n        case \"2:6\":\n            sIdent = \"CD\"; // Qobuz\n            break;\n    };\n\n    return sIdent;\n\n};\n\n// =======================================================\n// Start WiiM Display app\nWIIM.Init();\n"],"names":["window","WIIM","s","locHostname","location","hostname","locPort","port","rndAlbumArtUri","aDeviceUI","d","serverSettings","deviceList","prevTransportState","prevPlayMedium","prevSourceIdent","prevTrackInfo","r","Init","console","log","socket","io","connect","setUIReferences","setSocketDefinitions","setTimeout","emit","forEach","id","element","document","getElementById","warn","on","msg","timeStampDiff","CurrentTransportState","stateTimeStamp","metadataTimeStamp","Math","round","relTime","RelTime","trackDuration","TrackDuration","playerProgress","getPlayerProgress","progressPlayed","children","innerText","played","progressLeft","left","progressPercent","setAttribute","percent","PlayMedium","playMedium","trackSource","TrackSource","sourceIdent","getSourceIdent","identImg","createElement","src","alt","title","mediaSource","innerHTML","outerHTML","mediaTitle","Title","mediaSubTitle","Subtitle","mediaArtist","Artist","mediaAlbum","Album","trackChanged","currentTrackInfo","songBitrate","BitRate","songBitDepth","BitDepth","songSampleRate","SampleRate","mediaBitRate","toFixed","mediaBitDepth","mediaSampleRate","mediaQualityIdent","style","display","songQuality","Quality","songActualQuality","ActualQuality","qualiIdent","getQualityIdent","identId","className","albumArtUri","checkAlbumArtURI","AlbumCoverURI","TimeStamp","albumArt","setAlbumArt","devVol","CurrentVolume","currentTransportState","relTimeSec","convertToSeconds","trackDurationSec","percentPlayed","convertToMinutes","total","sDuration","timeSections","split","totalSeconds","i","length","nMultiplier","pow","parseInt","seconds","tempDate","Date","setSeconds","toISOString","substring","sAlbumArtUri","nTimestamp","startsWith","encodeURIComponent","imgUri","bgAlbumArtBlur","backgroundImage","rndNumber","min","max","floor","random","sIdentUri","toLowerCase","sIdent"],"version":3,"file":"wiimd.22ac49f2.js.map"}