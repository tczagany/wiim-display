window.WIIM=window.WIIM||{},WIIM.s={locHostname:location.hostname,locPort:location.port&&"80"!=location.port&&"1234"!=location.port?location.port:"80",rndAlbumArtUri:"./img/album-unknown.jpg",aDeviceUI:["devName","mediaTitle","mediaSubTitle","mediaArtist","mediaAlbum","mediaBitRate","mediaBitDepth","mediaSampleRate","mediaQualityIdent","devVol","progressPlayed","progressLeft","progressPercent","mediaSource","albumArt","bgAlbumArtBlur"]},WIIM.d={serverSettings:null,deviceList:null,prevTransportState:null,prevPlayMedium:null,prevSourceIdent:null,prevTrackInfo:null},WIIM.r={},WIIM.Init=function(){console.log("WIIM","Initialising..."),window.socket=parent.socket,console.log("WIIM","Socket",window.socket),this.setUIReferences(),this.setSocketDefinitions(),setTimeout(()=>{console.log("WIIM","Update request sent"),socket.emit("update-request")},500)},WIIM.updateTrackProgress=function(e){var t=WIIM.getPlayerProgress(e.trackPos/1e3,e.trackLen/1e3,e.state);WIIM.r.progressPlayed.children[0].innerText=t.played,WIIM.r.progressLeft.children[0].innerText=""!=t.left?"-"+t.left:"",WIIM.r.progressPercent.setAttribute("aria-valuenow",t.percent),WIIM.r.progressPercent.children[0].setAttribute("style","width:"+t.percent+"%")},WIIM.updateTrack=function(e){console.log(e),"stopped"==e.state?(WIIM.r.mediaTitle.innerText="",WIIM.r.mediaSubTitle.innerText="",WIIM.r.mediaArtist.innerText="",WIIM.r.mediaBitRate.innerText="",WIIM.r.mediaBitDepth.innerText="",WIIM.r.mediaSampleRate.innerText=""):(WIIM.r.mediaTitle.innerText=e.trackTitle,WIIM.r.mediaSubTitle.innerText=e.trackSubTitle,WIIM.r.mediaArtist.innerText=e.artist,WIIM.r.mediaBitRate.innerText=e.bitRate>0?e.bitRate>1e3?(e.bitRate/1e3).toFixed(2)+" mbps, ":e.bitRate+" kbps, ":"",WIIM.r.mediaBitDepth.innerText=e.bitDepth>0?e.bitDepth>24?"24 bit /":e.bitDepth+" bit /":"",WIIM.r.mediaSampleRate.innerText=e.sampleRate>0?(e.sampleRate/1e3).toFixed(1)+" kHz":""),"network"==e.source&&"stopped"!=e.state?(WIIM.r.mediaQualityIdent.style.display="inline-block",WIIM.r.mediaQualityIdent.className="badge badge-outlined"):WIIM.r.mediaQualityIdent.style.display="none"},WIIM.updateAlbumArt=function(e){if(WIIM.r.mediaAlbum.innerText="","network"==e.source)if("stopped"==e.state)WIIM.setAlbumArt("./img/album-silence.jpg");else{if(e.albumArt){var t=WIIM.checkAlbumArtURI(e,Date.now());WIIM.setAlbumArt(t)}else WIIM.setAlbumArt("./img/album-unknown.jpg");WIIM.r.mediaAlbum.innerText=e.album}else"bt"==e.source?"stopped"==e.state?WIIM.setAlbumArt("./img/album-silence.jpg"):WIIM.setAlbumArt("./img/album-bt.jpg"):"optin"==e.source?WIIM.setAlbumArt("./img/album-spdif.jpg"):"linein"==e.source&&WIIM.setAlbumArt("./img/album-linein.jpg")},WIIM.updateSourceImg=function(e){var t=document.createElement("img");"network"==e.source?t.src="./img/sources/ethernet2.png":"bt"==e.source?t.src="./img/sources/bluetooth2.png":"linein"==e.source?t.src="./img/sources/line-in2.png":"optin"==e.source&&(t.src="./img/sources/spdif2.png"),"tidal"==e.vendor&&(t.src="./img/sources/tidal2.png"),"spotify"==e.vendor&&(t.src="./img/sources/spotify.png"),WIIM.r.mediaSource.innerHTML=t.outerHTML},WIIM.setUIReferences=function(){console.log("WIIM","Set UI references..."),this.s.aDeviceUI.forEach(e=>{let t;(t=document.getElementById(e))?WIIM.r[e]=t:console.warn("WIIM",`Element with ID '${e}' not found.`)})},WIIM.setSocketDefinitions=function(){console.log("WIIM","Setting Socket definitions..."),socket.on("device-state",function(e){WIIM.r.devVol.innerText=e.volume,WIIM.r.devName.innerText=e.name+" / "+e.model,"1"===e.mute&&(WIIM.r.devVol.innerText="mute")}),socket.on("stream-state",function(e){WIIM.updateTrack(e),WIIM.updateTrackProgress(e),WIIM.updateSourceImg(e),WIIM.updateAlbumArt(e)}),socket.on("album-changed",function(e){WIIM.updateAlbumArt(e)}),socket.on("track-progress",function(e){WIIM.updateTrackProgress(e)}),socket.on("track-changed",function(e){WIIM.updateTrack(e)})},WIIM.getPlayerProgress=function(e,t,r){if("stopped"==r)return{played:"Stopped (No music selected)",left:"",total:"",percent:0};if(t>0&&e<t){var n=(e/t*100).toFixed(1),s=WIIM.convertToMinutes(e);return"paused"==r&&(s="Paused "+s),{played:s,left:WIIM.convertToMinutes(t-e),total:WIIM.convertToMinutes(t),percent:n}}return 0==t&&"playing"==r?{played:"Live Stream",left:"",total:"",percent:100}:{played:"",left:"",total:"",percent:100}},WIIM.convertToSeconds=function(e){if(void 0===e||"0"===e)return 0;let t=e.split(":"),r=0;for(let e=0;e<t.length;e++)r+=Math.pow(60,t.length-1-e)*parseInt(t[e]);return r},WIIM.convertToMinutes=function(e){var t=new Date(0);return t.setSeconds(e),t.toISOString().substring(14,19)},WIIM.checkAlbumArtURI=function(e,t){var r=e.albumArt;if(r&&r.startsWith("https"))if("80"!=WIIM.s.locPort)return"http://"+WIIM.s.locHostname+":"+WIIM.s.locPort+"/proxy?url="+encodeURIComponent(r)+"&ts="+t;else return"http://"+WIIM.s.locHostname+"/proxy?url="+encodeURIComponent(r)+"&ts="+t;return r&&r.startsWith("http")?"tunein"==e.vendor?(console.log("URI ",r=r.replace("http:","https:")),"http://"+WIIM.s.locHostname+":"+WIIM.s.locPort+"/proxy?url="+encodeURIComponent(r)+"&ts="+t):r:""},WIIM.setAlbumArt=function(e){console.log("WIIM","Set Album Art",e),this.r.albumArt.src=e,this.r.bgAlbumArtBlur.style.backgroundImage="url('"+e+"')"},WIIM.getSourceIdent=function(e,t){var r="";switch(e.toLowerCase()){case"airplay":r="./img/sources/airplay2.png";break;case"third-dlna":r="./img/sources/dlna2.png";break;case"cast":r="./img/sources/chromecast2.png";break;case"radio-network":r="./img/sources/radio.png";break;case"songlist-network":r="./img/sources/ethernet2.png";break;case"spotify":r="./img/sources/spotify.png";break;case"squeezelite":r="./img/sources/music-assistant2.png";break;case"none":r="./img/sources/none2.png";break;case"bluetooth":r="./img/sources/bluetooth2.png";break;case"hdmi":r="./img/sources/hdmi2.png";break;case"line-in":r="./img/sources/line-in2.png";break;case"optical":r="./img/sources/spdif2.png"}switch(t.toLowerCase()){case"deezer":case"deezer2":r="./img/sources/deezer.png";break;case"iheartradio":r="./img/sources/iheart.png";break;case"newtunein":r="./img/sources/newtunein.png";break;case"plex":r="./img/sources/plex.png";break;case"prime":r="./img/sources/amazon-music2.png";break;case"qobuz":r="./img/sources/qobuz2.png";break;case"tidal":r="./img/sources/tidal2.png";break;case"upnpserver":r="./img/sources/dlna2.png";break;case"vtuner":r="./img/sources/vtuner2.png"}return r},WIIM.Init();
//# sourceMappingURL=wiimd.4794ebd1.js.map
