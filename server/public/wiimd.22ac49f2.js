window.WIIM=window.WIIM||{},WIIM.s={locHostname:location.hostname,locPort:location.port&&"80"!=location.port&&"1234"!=location.port?location.port:"80",rndAlbumArtUri:"./img/fake-album-1.jpg",aDeviceUI:["devName","mediaTitle","mediaSubTitle","mediaArtist","mediaAlbum","mediaBitRate","mediaBitDepth","mediaSampleRate","mediaQualityIdent","devVol","progressPlayed","progressLeft","progressPercent","mediaSource","albumArt","bgAlbumArtBlur"]},WIIM.d={serverSettings:null,deviceList:null,prevTransportState:null,prevPlayMedium:null,prevSourceIdent:null,prevTrackInfo:null},WIIM.r={},WIIM.Init=function(){console.log("WIIM","Initialising..."),console.log("WIIM DEBUG","Listening on "+this.s.locHostname+":"+this.s.locPort),window.socket=io.connect(":"+this.s.locPort),this.setUIReferences(),this.setSocketDefinitions(),setTimeout(()=>{socket.emit("server-settings"),socket.emit("devices-get")},500)},WIIM.setUIReferences=function(){console.log("WIIM","Set UI references..."),this.s.aDeviceUI.forEach(e=>{let t;(t=document.getElementById(e))?WIIM.r[e]=t:console.warn("WIIM",`Element with ID '${e}' not found.`)})},WIIM.setSocketDefinitions=function(){console.log("WIIM","Setting Socket definitions..."),socket.on("state",function(e){if(!e)return!1;var t=0;"PLAYING"===e.CurrentTransportState&&(t=e.stateTimeStamp&&e.metadataTimeStamp?Math.round((e.stateTimeStamp-e.metadataTimeStamp)/1e3):0);var r=e.RelTime?e.RelTime:"00:00:00",n=e.TrackDuration?e.TrackDuration:"00:00:00",i=WIIM.getPlayerProgress(r,n,t,e.CurrentTransportState);progressPlayed.children[0].innerText=i.played,progressLeft.children[0].innerText=""!=i.left?"-"+i.left:"",progressPercent.setAttribute("aria-valuenow",i.percent),progressPercent.children[0].setAttribute("style","width:"+i.percent+"%"),(WIIM.d.prevTransportState!==e.CurrentTransportState||WIIM.d.prevPlayMedium!==e.PlayMedium)&&(WIIM.d.prevTransportState=e.CurrentTransportState,WIIM.d.prevPlayMedium=e.PlayMedium)}),socket.on("metadata",function(e){if(!e)return!1;var t=e.PlayMedium?e.PlayMedium:"",r=e.TrackSource?e.TrackSource:"",n=WIIM.getSourceIdent(t,r);if(n!==WIIM.d.prevSourceIdent){if(""!==n){var i=document.createElement("img");i.src=n,i.alt=t+": "+r,i.title=t+": "+r,mediaSource.innerHTML=i.outerHTML}else mediaSource.innerText=t+": "+r;WIIM.d.prevSourceIdent=n}WIIM.r.mediaTitle.innerText=e.Title?e.Title:"",WIIM.r.mediaSubTitle.innerText=e.Subtitle?e.Subtitle:"",WIIM.r.mediaArtist.innerText=e.Artist?e.Artist:"",WIIM.r.mediaAlbum.innerText=e.Album?e.Album:"","SONGLIST-NETWORK"!==t||r||"STOPPED"!==e.CurrentTransportState||(WIIM.r.mediaTitle.innerText="No Music Selected");var a=!1,s=WIIM.r.mediaTitle.innerText+"|"+WIIM.r.mediaSubTitle.innerText+"|"+WIIM.r.mediaArtist.innerText+"|"+WIIM.r.mediaAlbum.innerText;WIIM.d.prevTrackInfo!==s&&(a=!0,WIIM.d.prevTrackInfo=s,console.log("WIIM","Track changed:",s));var o=e.BitRate?e.BitRate:"",c=e.BitDepth?e.BitDepth:"",l=e.SampleRate?e.SampleRate:"";WIIM.r.mediaBitRate.innerText=o>0?o>1e3?(o/1e3).toFixed(2)+" mbps, ":o+" kbps, ":"",WIIM.r.mediaBitDepth.innerText=c>0?c>24?"24 bit/":c+" bit/":"",WIIM.r.mediaSampleRate.innerText=l>0?(l/1e3).toFixed(1)+" kHz":"",o||c||l?WIIM.r.mediaQualityIdent.style.display="inline-block":WIIM.r.mediaQualityIdent.style.display="none";var I=e.Quality?e.Quality:"",u=e.ActualQuality?e.ActualQuality:"",m=WIIM.getQualityIdent(I,u,o,c,l);if(""!==m)WIIM.r.mediaQualityIdent.innerText=m,WIIM.r.mediaQualityIdent.title="Quality: "+I+", "+u;else{var d=document.createElement("i");d.className="bi bi-soundwave text-secondary",d.title="Quality: "+I+", "+u,WIIM.r.mediaQualityIdent.innerHTML=d.outerHTML}var p=WIIM.checkAlbumArtURI(e.AlbumCoverURI?e.AlbumCoverURI:"",e.TimeStamp);a&&WIIM.r.albumArt.src!=p&&WIIM.setAlbumArt(p),WIIM.r.devVol.innerText=e.CurrentVolume?e.CurrentVolume:"-"}),socket.on("device-set",function(e){socket.emit("server-settings"),socket.emit("devices-get")})},WIIM.getPlayerProgress=function(e,t,r,n){var i=this.convertToSeconds(e)+r,a=this.convertToSeconds(t);if(a>0&&i<a){var s=(i/a*100).toFixed(1);return{played:WIIM.convertToMinutes(i),left:WIIM.convertToMinutes(a-i),total:WIIM.convertToMinutes(a),percent:s}}return 0==a&&"PLAYING"==n?{played:"Live",left:"",total:"",percent:100}:{played:"Paused",left:"",total:"",percent:0}},WIIM.convertToSeconds=function(e){let t=e.split(":"),r=0;for(let e=0;e<t.length;e++)r+=Math.pow(60,t.length-1-e)*parseInt(t[e]);return r},WIIM.convertToMinutes=function(e){var t=new Date(0);return t.setSeconds(e),t.toISOString().substring(14,19)},WIIM.checkAlbumArtURI=function(e,t){if(e&&e.startsWith("https"))if("80"!=WIIM.s.locPort)return"http://"+WIIM.s.locHostname+":"+WIIM.s.locPort+"/proxy?url="+encodeURIComponent(e)+"&ts="+t;else return"http://"+WIIM.s.locHostname+"/proxy?url="+encodeURIComponent(e)+"&ts="+t;return e&&e.startsWith("http")?e:WIIM.s.rndAlbumArtUri},WIIM.setAlbumArt=function(e){console.log("WIIM","Set Album Art",e),this.r.albumArt.src=e,this.r.bgAlbumArtBlur.style.backgroundImage="url('"+e+"')"},WIIM.rndNumber=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},WIIM.getSourceIdent=function(e,t){var r="";switch(e.toLowerCase()){case"airplay":r="./img/sources/airplay2.png";break;case"third-dlna":r="./img/sources/dlna2.png";break;case"cast":r="./img/sources/chromecast2.png";break;case"radio-network":r="./img/sources/radio.png";break;case"songlist-network":r="./img/sources/ethernet2.png";break;case"spotify":r="./img/sources/spotify.png";break;case"squeezelite":r="./img/sources/music-assistant2.png";break;case"none":r="./img/sources/none2.png";break;case"bluetooth":r="./img/sources/bluetooth2.png";break;case"hdmi":r="./img/sources/hdmi2.png";break;case"line-in":r="./img/sources/line-in2.png";break;case"optical":r="./img/sources/spdif2.png"}switch(t.toLowerCase()){case"deezer":case"deezer2":r="./img/sources/deezer.png";break;case"iheartradio":r="./img/sources/iheart.png";break;case"newtunein":r="./img/sources/newtunein.png";break;case"plex":r="./img/sources/plex.png";break;case"prime":r="./img/sources/amazon-music2.png";break;case"qobuz":r="./img/sources/qobuz2.png";break;case"tidal":r="./img/sources/tidal2.png";break;case"upnpserver":r="./img/sources/dlna2.png";break;case"vtuner":r="./img/sources/vtuner2.png"}return r},WIIM.getQualityIdent=function(e,t,r,n,i){var a="";switch(r>1e3&&16===n&&44100===i?a="CD":r>7e3&&n>=24&&i>=96e3&&(a="Hi-Res"),e+":"+t){case"2:LOSSLESS":case":LOSSLESS":a="HIGH";break;case"3:HI_RES":a="MQA";break;case"4:HI_RES_LOSSLESS":case":HI_RES_LOSSLESS":case"0:LOSSLESS":a="FLAC";break;case":UHD":a="ULTRA HD";break;case":HD":a="HD";break;case"3:7":case"4:27":a="Hi-Res";break;case"2:6":a="CD"}return a},WIIM.Init();
//# sourceMappingURL=wiimd.22ac49f2.js.map
